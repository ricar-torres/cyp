<mat-progress-bar
  *ngIf="download$ | async as download"
  [mode]="download.state == 'PENDING' ? 'buffer' : 'determinate'"
  [value]="download.progress"
>
</mat-progress-bar>
<md-content layout-margin layout-padding flex="50">
  <mat-card>
    <mat-card-header>
      <mat-card-title>{{ 'FILE.TITLE' | translate }}</mat-card-title>
      <mat-card-subtitle># {{ FILE.key }}</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <!-- <speed-dial-fab class="speed-dial-container" [ngClass]="speedDialFabPosition" [reverse-column-direction]="speedDialFabPosition===SpeedDialFabPosition.Bottom" (fabClick)="onSpeedDialFabClicked($event)" [buttons]="speedDialFabButtons"></speed-dial-fab> -->
      <app-speed-dial-fab
        *ngIf="fabMenuButtons.visible"
        (fabClick)="onSpeedDialFabClicked($event)"
        [buttons]="fabMenuButtons.buttons"
      ></app-speed-dial-fab>

      <form class="form">
        <div fxLayout="column" fxLayoutAlign="end end">
          <mat-chip-list>
            <mat-chip color="primary" selected *ngIf="!FILE.delFlag">{{
              'FILE.ACTIVE' | translate
            }}</mat-chip>
            <mat-chip color="warn" selected *ngIf="FILE.delFlag">{{
              'FILE.INACTIVE' | translate
            }}</mat-chip>
          </mat-chip-list>
        </div>

        <table class="full-width" cellspacing="0">
          <tr>
            <td>
              <mat-form-field class="full-width">
                <mat-label>{{ 'FILE.FIRST_NAME' | translate }}</mat-label>
                <input disabled matInput [value]="FILE.firstName" />
              </mat-form-field>
            </td>
            <td>
              <mat-form-field class="full-width">
                <mat-label>{{ 'FILE.LAST_NAME' | translate }}</mat-label>
                <input disabled matInput [value]="FILE.lastName" />
              </mat-form-field>
            </td>
          </tr>
        </table>

        <table class="full-width" cellspacing="0">
          <tr>
            <td>
              <mat-form-field class="full-width">
                <mat-label>{{ 'FILE.TYPE' | translate }}</mat-label>
                <input disabled matInput [value]="FILE.type" />
              </mat-form-field>
            </td>
            <td>
              <mat-form-field class="full-width">
                <mat-label>{{ 'FILE.REF1' | translate }}</mat-label>
                <input disabled matInput [value]="FILE.reference1" />
              </mat-form-field>
            </td>
          </tr>
        </table>

        <table class="full-width" cellspacing="0">
          <tr>
            <td>
              <mat-form-field class="full-width">
                <mat-label>{{ 'FILE.EMAIL' | translate }}</mat-label>
                <input disabled matInput [value]="FILE.email" />
              </mat-form-field>
            </td>
            <td>
              <mat-form-field class="full-width">
                <mat-label>{{ 'FILE.PHONE_NUMBER' | translate }}</mat-label>
                <input disabled matInput [value]="FILE.phoneNumber" />
              </mat-form-field>
            </td>
          </tr>
        </table>

        <mat-form-field class="full-width">
          <mat-label>{{ 'FILE.DESCRIPTION' | translate }}</mat-label>
          <textarea matInput rows="4" disabled>{{ FILE.description }}</textarea>
        </mat-form-field>

        <mat-tab-group class="margin-top-10">
          <!-- DOCUMENTS -->

          <mat-tab>
            <ng-template mat-tab-label>
              <fa-icon [icon]="faFile"></fa-icon>
              &nbsp;{{ 'FILE.DOCUMENTS' | translate }}
            </ng-template>

            <!-- <div fxLayout class="margin-top-10">
              <div fxLayout fxLayoutAlign="end center" class="full-width">
                <button mat-button color="accent" (click)="toggleDocView()">
                  <fa-icon [icon]="faGripHorizontal" *ngIf="documentsView == 'list'"></fa-icon>
                  <fa-icon [icon]="faList" *ngIf="documentsView == 'grid'"></fa-icon>
                </button>
              </div>
            </div> -->
            <div class="margin-top-10">
              <app-drag-n-drop-zone
                class="full-width"
                (onFilesLoaded)="onFilesLoaded($event)"
                *ngIf="docPermissions.create && FILE.delFlag == false"
              >
              </app-drag-n-drop-zone>
            </div>

            <!-- <div *ngIf="documentsView == 'grid'" fxLayout="row wrap" fxLayoutGap="32px" fxLayoutAlign="flex-start">

              <div *ngFor="let tile of DOCS" class="doc" fxLayout="column" fxLayoutAlign="center center">

                <a class="doc-icon" (click)="viewDocument(row)">

                  <fa-icon [icon]="faFile" size="5x" *ngIf="tile.ext != 'pdf' && tile.ext != 'jpeg' "></fa-icon>
                  <fa-icon [icon]="faFileImage" size="5x" *ngIf="tile.ext == 'jpeg'"></fa-icon>
                  <fa-icon [icon]="faFilePdf" size="5x" *ngIf="tile.ext == 'pdf'"></fa-icon>

                </a>
                <span class="element-description-attribution">{{ tile.tag }}</span>
                <small class="element-description-attribution">{{ tile.createdUser }}</small>
                <small class="element-description-attribution">{{ tile.createDt | date: 'MM/dd/yyyy' }}</small>

              </div>

            </div> -->
            <!-- <div *ngIf="documentsView == 'list'"> -->

            <div fxLayout="row" fxLayoutAlign="end end" fxLayoutGap="5px">
              <mat-label>{{
                'FILE.ONLY_ACTIVE_DOCUMENT' | translate
              }}</mat-label>
              <mat-slide-toggle
                (change)="onActiveToggleChange($event)"
                [checked]="onlyActiveDocument"
              >
              </mat-slide-toggle>
            </div>

            <div fxLayout fxLayoutGap="32px">
              <mat-form-field>
                <input
                  matInput
                  placeholder="{{ 'FILE.SEARCH' | translate }}"
                  type="text"
                  (keyup)="doDocumentFilter($event.target.value)"
                />
              </mat-form-field>
            </div>

            <div>
              <table mat-table [dataSource]="dsDocuments" #docsTable matSort>
                <!-- name Column -->
                <!-- <ng-container matColumnDef="icon">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
                  <td mat-cell *matCellDef="let element">
                    <fa-icon [icon]="faFile" size="2x" *ngIf="
                        element.ext != 'pdf' &&
                        element.ext == 'image/jpeg' &&
                        element.ext != 'image/png'
                      ">
                    </fa-icon>
                    <fa-icon [icon]="faFileImage" size="2x" *ngIf="
                        element.ext == 'image/jpeg' ||
                        element.ext == 'image/png'
                      "></fa-icon>
                    <fa-icon [icon]="faFilePdf" size="2x" *ngIf="element.ext == 'pdf'"></fa-icon>
                  </td>
                </ng-container> -->

                <!-- tag Column -->
                <ng-container matColumnDef="tag">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    {{ 'FILE.TAG' | translate }}
                  </th>
                  <td
                    [matTooltip]="element.name"
                    mat-cell
                    *matCellDef="let element"
                  >
                    {{ element.tag }}
                  </td>
                </ng-container>

                <!-- createdUser Column -->
                <ng-container matColumnDef="createdUser">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    {{ 'FILE.WORKED_BY' | translate }}
                  </th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.createdUser }}
                  </td>
                </ng-container>

                <!-- updateUser Column -->
                <ng-container matColumnDef="updateUser">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    {{ 'FILE.UPDATED_BY' | translate }}
                  </th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.updateUser }}
                  </td>
                </ng-container>

                <!-- createDt Column -->
                <ng-container matColumnDef="createDt">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    {{ 'FILE.DOC_DATE' | translate }}
                  </th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.createDt | date: 'MM/dd/yyyy' }}
                  </td>
                </ng-container>

                <!-- updDt Column -->
                <ng-container matColumnDef="updDt">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    {{ 'FILE.UPDATED_DATE' | translate }}
                  </th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.updDt | date: 'MM/dd/yyyy' }}
                  </td>
                </ng-container>

                <!-- origin Column -->
                <ng-container matColumnDef="origin">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    {{ 'FILE.ORIGIN' | translate }}
                  </th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.origin }}
                  </td>
                </ng-container>

                <!-- delFlag Column -->
                <ng-container matColumnDef="delFlag">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
                  <td mat-cell *matCellDef="let element">
                    <mat-chip-list>
                      <mat-chip
                        color="primary"
                        selected
                        *ngIf="!element.delFlag"
                        >{{ 'FILE.ACTIVE' | translate }}
                      </mat-chip>
                      <mat-chip color="warn" selected *ngIf="element.delFlag"
                        >{{ 'FILE.DELETED' | translate }}
                      </mat-chip>
                    </mat-chip-list>
                  </td>
                </ng-container>

                <!-- download Column -->
                <ng-container matColumnDef="download">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
                  <td mat-cell *matCellDef="let element">
                    <button
                      mat-button
                      (click)="onDownload(element.document)"
                      *ngIf="element.ext"
                    >
                      <fa-icon [icon]="faDownload"></fa-icon>
                    </button>
                  </td>
                </ng-container>

                <!-- edit Column -->
                <ng-container matColumnDef="edit">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
                  <td mat-cell *matCellDef="let element">
                    <button mat-button (click)="viewDocument(element)">
                      <fa-icon [icon]="faEdit"></fa-icon>
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="dcDocuments"></tr>
                <tr mat-row *matRowDef="let row; columns: dcDocuments"></tr>
              </table>

              <mat-paginator
                #paginatorDocuments
                [pageSize]="pageSizeDocuments"
                [pageSizeOptions]="pageSizeOptionsDocuments"
                (page)="pageEventDocuments = $event"
              >
              </mat-paginator>
            </div>
          </mat-tab>

          <!-- TASKS -->
          <mat-tab>
            <ng-template mat-tab-label>
              <fa-icon [icon]="faTasks"></fa-icon>
              &nbsp;{{ 'FILE.TASKS' | translate }}
            </ng-template>

            <!-- <div fxLayout fxLayoutAlign="end start">
              <button type="button" mat-raised-button color="primary" (click)="newTask()" class="margin-top-10">
                <mat-icon>add</mat-icon> {{ 'FILE.ADD_TASK_BTN' | translate }}
              </button>
            </div> -->

            <div fxLayout class="margin-top-10">
              <mat-form-field class="full-width">
                <input
                  matInput
                  placeholder="{{ 'FILE.SEARCH' | translate }}"
                  type="text"
                  (keyup)="doTaskFilter($event.target.value)"
                />
              </mat-form-field>
            </div>

            <table
              #tasksTable
              mat-table
              [dataSource]="dsTasks"
              multiTemplateDataRows
              matSort
              class="mat-elevation-z8"
            >
              <!-- name Column -->
              <ng-container matColumnDef="documentId">
                <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
                <td mat-cell *matCellDef="let element">
                  <fa-icon
                    *ngIf="element.documentId"
                    [icon]="faPaperclip"
                  ></fa-icon>
                </td>
              </ng-container>

              <!-- name Column -->
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  {{ 'FILE.FROM' | translate }}
                </th>
                <td mat-cell *matCellDef="let element">
                  {{ element.adminUserName }}
                </td>
                <!-- <td mat-cell *matCellDef="let element" (click)="goToDetail(element.id)">{{element.client.fullName}} </td> -->
              </ng-container>

              <!-- details Column -->
              <ng-container matColumnDef="details">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  {{ 'FILE.TASK' | translate }}
                </th>
                <td mat-cell *matCellDef="let element">
                  <b>{{
                    element.documentType
                      ? element.documentTypeName
                      : element.details.substring(0, 20)
                  }}</b>
                </td>
              </ng-container>

              <!-- createDt Column -->
              <ng-container matColumnDef="createDt">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  {{ 'FILE.DATE' | translate }}
                </th>
                <td mat-cell *matCellDef="let element">
                  {{ element.createDt | amCalendar: nextDay }}
                </td>
              </ng-container>

              <!-- updDt Column -->
              <ng-container matColumnDef="updDt">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  {{ 'FILE.UPDATED_DATE' | translate }}
                </th>
                <td mat-cell *matCellDef="let element">
                  {{ element.updDt | amCalendar: nextDay }}
                </td>
              </ng-container>

              <!-- status Column -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  {{ 'FILE.STATUS' | translate }}
                </th>
                <td mat-cell *matCellDef="let element">{{ element.status }}</td>
              </ng-container>

              <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
              <ng-container matColumnDef="expandedDetail">
                <td
                  mat-cell
                  *matCellDef="let element"
                  [attr.colspan]="dcTasks.length"
                >
                  <div
                    [@detailExpand]="
                      element == expandedElement ? 'expanded' : 'collapsed'
                    "
                  >
                    <app-task-details
                      [task]="element"
                      [actionButtons]="true"
                      (onApprove)="onApprove(element)"
                      (onArchive)="onArchive(element)"
                      (onCancel)="onCancel(element)"
                      (onRecover)="onRecover(element)"
                      (onDownloadFile)="onDownload(element.document)"
                      (onDownloadTemplate)="onDownload(element.templateFile)"
                    >
                    </app-task-details>
                  </div>
                </td>
              </ng-container>

              <!-- <tr mat-header-row *matHeaderRowDef="dcTasks"></tr>
                            <tr mat-row *matRowDef="let row; columns: dcTasks;" (click)="selection.toggle(row)"></tr> -->

              <tr mat-header-row *matHeaderRowDef="dcTasks"></tr>
              <tr
                mat-row
                *matRowDef="let row; columns: dcTasks"
                class="element-row"
                [class.expanded]="expandedElement == row"
                (click)="expandedElement = row"
              ></tr>

              <tr
                mat-row
                *matRowDef="let row; columns: ['expandedDetail']"
                class="detail-row"
              ></tr>
            </table>

            <mat-paginator
              #paginatorTasks
              [pageSize]="pageSizeTasks"
              [pageSizeOptions]="pageSizeOptionsTasks"
              (page)="pageEventTasks = $event"
            >
            </mat-paginator>
          </mat-tab>

          <!-- COMMENTS -->
          <mat-tab>
            <ng-template mat-tab-label>
              <fa-icon [icon]="faComments"></fa-icon>
              &nbsp;{{ 'FILE.COMMENTS' | translate }}
            </ng-template>

            <div fxLayout fxLayoutGap="32px">
              <mat-form-field>
                <input
                  matInput
                  placeholder="{{ 'FILE.SEARCH' | translate }}"
                  type="text"
                  (keyup)="doCommentFilter($event.target.value)"
                />
              </mat-form-field>
            </div>

            <table
              mat-table
              [dataSource]="dsComments"
              #commentsTable
              matSort
              class="mat-elevation-z8"
            >
              <!-- name text -->
              <ng-container matColumnDef="text">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  {{ 'FILE.COMMENT' | translate }}
                </th>
                <td mat-cell *matCellDef="let element">
                  {{ element.text.substring(0, 80) }}...
                </td>
              </ng-container>

              <!-- name createUser -->
              <ng-container matColumnDef="createdUser">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  {{ 'FILE.WORKED_BY' | translate }}
                </th>
                <td mat-cell *matCellDef="let element">
                  {{ element.createdUser.fullName }}
                </td>
              </ng-container>

              <!-- name createDt -->
              <ng-container matColumnDef="createDt">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  {{ 'FILE.DOC_DATE' | translate }}
                </th>
                <td mat-cell *matCellDef="let element">
                  {{ element.createDt | date: 'MM/dd/yyyy' }}
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="dcComments"></tr>
              <tr
                mat-row
                *matRowDef="let row; columns: dcComments"
                (click)="viewComment(row)"
              ></tr>
            </table>

            <mat-paginator
              #paginatorComments
              [pageSize]="pageSizeComments"
              [pageSizeOptions]="pageSizeOptionsComments"
              (page)="pageEventComments = $event"
            >
            </mat-paginator>
          </mat-tab>

          <!-- LINKED_FILES -->
          <mat-tab>
            <ng-template mat-tab-label>
              <fa-icon [icon]="faLink"></fa-icon>
              &nbsp;{{ 'FILE.LINKED_FILES' | translate }}
            </ng-template>

            <table
              mat-table
              [dataSource]="dsLinkedFiles"
              #linkedFilesTable
              matSort
              class="mat-elevation-z8"
            >
              <!-- name relationKey -->
              <ng-container matColumnDef="relationKey">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  {{ 'FILE.KEY' | translate }}
                </th>
                <td mat-cell *matCellDef="let element">{{ element.key }}</td>
              </ng-container>

              <!-- name fullName -->
              <ng-container matColumnDef="fullName">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  {{ 'FILE.NAME' | translate }}
                </th>
                <td mat-cell *matCellDef="let element">
                  {{ element.fullName }}
                </td>
              </ng-container>

              <!-- name reference1 -->
              <ng-container matColumnDef="reference1">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  {{ 'FILE.REF1' | translate }}
                </th>
                <td mat-cell *matCellDef="let element">
                  {{ element.reference1 }}
                </td>
              </ng-container>

              <!-- name reference1 -->
              <ng-container matColumnDef="type">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  {{ 'FILE.TYPE' | translate }}
                </th>
                <td mat-cell *matCellDef="let element">{{ element.type }}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="dcLinkedFiles"></tr>
              <tr
                mat-row
                *matRowDef="let row; columns: dcLinkedFiles"
                (click)="goToRelatedFile(row.id)"
              ></tr>
            </table>

            <mat-paginator
              #paginatorLinkedFiles
              [pageSize]="pageSizeLinkedFiles"
              [pageSizeOptions]="pageSizeOptionsLinkedFiles"
              (page)="pageEventLinkedFiles = $event"
            >
            </mat-paginator>
          </mat-tab>
        </mat-tab-group>
      </form>
    </mat-card-content>
    <mat-card-actions> </mat-card-actions>
  </mat-card>
</md-content>

<!-- loader.component.html -->
<div class="loading-indicator" [hidden]="!loading">
  <mat-progress-spinner [mode]="'indeterminate'"> </mat-progress-spinner>
</div>
