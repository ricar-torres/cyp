<mat-progress-bar
  *ngIf="download$ | async as download"
  [mode]="download.state == 'PENDING' ? 'buffer' : 'determinate'"
  [value]="download.progress"
>
</mat-progress-bar>
<mat-card>
  <mat-card-header>
    <mat-card-title>{{ 'DASHBOARD.TITLE' | translate }}</mat-card-title>
    <!-- <mat-card-subtitle>Dog Breed</mat-card-subtitle> -->
  </mat-card-header>
  <mat-card-content>
    <div fxLayout="row" fxLayoutAlign="end start" fxLayoutGap="5px">
      <mat-label>{{ 'DASHBOARD.ALL_TASKS' | translate }}</mat-label>
      <mat-slide-toggle
        (change)="loadTasks()"
        [(ngModel)]="allTasks"
      ></mat-slide-toggle>
    </div>

    <mat-tab-group>
      <!-- INBOX -->
      <mat-tab>
        <ng-template mat-tab-label>
          <fa-icon [icon]="faInbox"></fa-icon>
          &nbsp;<span [matBadge]="inboxBadge" matBadgeOverlap="false">{{
            'DASHBOARD.INBOX' | translate
          }}</span>
        </ng-template>

        <div fxLayout class="search">
          <mat-form-field class="full-width">
            <input
              matInput
              placeholder="{{ 'DASHBOARD.SEARCH' | translate }}"
              type="text"
              (keyup)="doInboxFilter($event.target.value)"
            />
          </mat-form-field>
        </div>

        <table
          #inboxTable
          matSort
          mat-table
          [dataSource]="dsInbox"
          multiTemplateDataRows
          class="mat-elevation-z8"
        >
          <!-- attachment Column -->
          <ng-container matColumnDef="attachment">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              <fa-icon *ngIf="element.document" [icon]="faPaperclip"></fa-icon>
            </td>
          </ng-container>

          <!-- name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              {{ element.taskUserFullName }}
            </td>
            <!-- <td mat-cell *matCellDef="let element" (click)="goToDetail(element.id)">{{element.client.fullName}} </td> -->
          </ng-container>

          <!-- reference1 Column -->
          <ng-container matColumnDef="reference1">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">{{ element.reference1 }}</td>
          </ng-container>

          <!-- details Column -->
          <ng-container matColumnDef="details">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              <b>{{
                element.documentType
                  ? element.documentType.name
                  : element.details.substring(0, 20)
              }}</b>
            </td>
          </ng-container>

          <!-- adminUserName Column -->
          <ng-container matColumnDef="adminUserName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              {{ element.adminUserName }}
            </td>
          </ng-container>

          <!-- date Column -->
          <ng-container matColumnDef="date">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              {{ element.updDt | date: 'MM/dd/yyyy hh:mm:ss a' }}
            </td>
          </ng-container>

          <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
          <ng-container matColumnDef="expandedDetail">
            <td
              mat-cell
              *matCellDef="let element"
              [attr.colspan]="displayedColumns.length"
            >
              <div
                [@detailExpand]="
                  element == expandedElement ? 'expanded' : 'collapsed'
                "
              >
                <app-task-details
                  [task]="element"
                  [actionButtons]="true"
                  (onApprove)="onApprove(element)"
                  (onArchive)="onArchive(element)"
                  (onCancel)="onCancel(element)"
                  (onRecover)="onRecover(element)"
                  (onDownloadFile)="onDownload(element.document)"
                  (onDownloadTemplate)="onDownload(element.templateFile)"
                >
                </app-task-details>
              </div>
            </td>
          </ng-container>

          <!-- <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="selection.toggle(row)"></tr> -->

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns"
            class="element-row"
            [class.expanded]="expandedElement == row"
            (click)="expandedElement = row"
          ></tr>

          <tr
            mat-row
            *matRowDef="let row; columns: ['expandedDetail']"
            class="detail-row"
          ></tr>
        </table>

        <mat-paginator
          #paginatorInbox
          [pageSize]="pageSize"
          [pageSizeOptions]="pageSizeOptions"
          (page)="pageEventInbox = $event"
        >
        </mat-paginator>
      </mat-tab>

      <!-- SENT -->
      <mat-tab>
        <ng-template mat-tab-label>
          <fa-icon [icon]="faPaperPlane"></fa-icon>
          &nbsp;{{ 'DASHBOARD.SENT' | translate }}
        </ng-template>

        <div fxLayout class="search">
          <mat-form-field class="full-width">
            <input
              matInput
              placeholder="{{ 'DASHBOARD.SEARCH' | translate }}"
              type="text"
              (keyup)="doSentFilter($event.target.value)"
            />
          </mat-form-field>
        </div>

        <table
          #sentTable
          mat-table
          [dataSource]="dsSent"
          multiTemplateDataRows
          matSort
          class="mat-elevation-z8"
        >
          <!-- attachment Column -->
          <ng-container matColumnDef="attachment">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              <fa-icon *ngIf="element.document" [icon]="faPaperclip"></fa-icon>
            </td>
          </ng-container>

          <!-- name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              {{ element.taskUserFullName }}
            </td>
            <!-- <td mat-cell *matCellDef="let element" (click)="goToDetail(element.id)">{{element.client.fullName}} </td> -->
          </ng-container>

          <!-- reference1 Column -->
          <ng-container matColumnDef="reference1">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">{{ element.reference1 }}</td>
          </ng-container>

          <!-- details Column -->
          <ng-container matColumnDef="details">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              <b>{{
                element.documentType
                  ? element.documentType.name
                  : element.details.substring(0, 20)
              }}</b>
            </td>
          </ng-container>

          <!-- adminUserName Column-->
          <ng-container matColumnDef="adminUserName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              {{ element.adminUserName }}
            </td>
          </ng-container>

          <!-- date Column -->
          <ng-container matColumnDef="date">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              {{ element.createDt | date: 'MM/dd/yyyy hh:mm:ss a' }}
            </td>
          </ng-container>

          <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
          <ng-container matColumnDef="expandedDetail">
            <td
              mat-cell
              *matCellDef="let element"
              [attr.colspan]="displayedColumns.length"
            >
              <div
                [@detailExpand]="
                  element == expandedElement ? 'expanded' : 'collapsed'
                "
              >
                <app-task-details
                  [task]="element"
                  [actionButtons]="true"
                  (onApprove)="onApprove(element)"
                  (onArchive)="onArchive(element)"
                  (onCancel)="onCancel(element)"
                  (onRecover)="onRecover(element)"
                  (onDownloadFile)="onDownload(element.document)"
                  (onDownloadTemplate)="onDownload(element.templateFile)"
                >
                </app-task-details>
              </div>
            </td>
          </ng-container>

          <!-- <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                  <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="selection.toggle(row)"></tr> -->

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns"
            class="element-row"
            [class.expanded]="expandedElement == row"
            (click)="expandedElement = row"
          ></tr>

          <tr
            mat-row
            *matRowDef="let row; columns: ['expandedDetail']"
            class="detail-row"
          ></tr>
        </table>

        <mat-paginator
          #paginatorSent
          [pageSize]="pageSize"
          [pageSizeOptions]="pageSizeOptions"
          (page)="pageEventSent = $event"
        >
        </mat-paginator>
      </mat-tab>

      <!-- APPROVED -->
      <mat-tab>
        <ng-template mat-tab-label>
          <fa-icon [icon]="faThumbsUp"></fa-icon>
          &nbsp;{{ 'DASHBOARD.APPROVED' | translate }}
        </ng-template>

        <div fxLayout class="search">
          <mat-form-field class="full-width">
            <input
              matInput
              placeholder="{{ 'DASHBOARD.SEARCH' | translate }}"
              type="text"
              (keyup)="doCompletedFilter($event.target.value)"
            />
          </mat-form-field>
        </div>

        <table
          #completeTable
          mat-table
          [dataSource]="dsCompleted"
          multiTemplateDataRows
          matSort
          class="mat-elevation-z8"
        >
          <!-- name Column -->
          <ng-container matColumnDef="attachment">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              <fa-icon *ngIf="element.document" [icon]="faPaperclip"></fa-icon>
            </td>
          </ng-container>

          <!-- name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              {{ element.taskUserFullName }}
            </td>
            <!-- <td mat-cell *matCellDef="let element" (click)="goToDetail(element.id)">{{element.client.fullName}} </td> -->
          </ng-container>

          <!-- reference1 Column -->
          <ng-container matColumnDef="reference1">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">{{ element.reference1 }}</td>
          </ng-container>

          <!-- details Column -->
          <ng-container matColumnDef="details">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              <b>{{
                element.documentType
                  ? element.documentType.name
                  : element.details.substring(0, 20)
              }}</b>
            </td>
          </ng-container>

          <!-- adminUserName Column-->
          <ng-container matColumnDef="adminUserName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              {{ element.adminUserName }}
            </td>
          </ng-container>

          <!-- details Column -->
          <ng-container matColumnDef="date">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              {{ element.updDt | date: 'MM/dd/yyyy hh:mm:ss a' }}
            </td>
          </ng-container>

          <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
          <ng-container matColumnDef="expandedDetail">
            <td
              mat-cell
              *matCellDef="let element"
              [attr.colspan]="displayedColumns.length"
            >
              <div
                [@detailExpand]="
                  element == expandedElement ? 'expanded' : 'collapsed'
                "
              >
                <app-task-details
                  [task]="element"
                  [actionButtons]="true"
                  (onApprove)="onApprove(element)"
                  (onArchive)="onArchive(element)"
                  (onCancel)="onCancel(element)"
                  (onRecover)="onRecover(element)"
                  (onDownloadFile)="onDownload(element.document)"
                  (onDownloadTemplate)="onDownload(element.templateFile)"
                >
                </app-task-details>
              </div>
            </td>
          </ng-container>

          <!-- <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="selection.toggle(row)"></tr> -->

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns"
            class="element-row"
            [class.expanded]="expandedElement == row"
            (click)="expandedElement = row"
          ></tr>

          <tr
            mat-row
            *matRowDef="let row; columns: ['expandedDetail']"
            class="detail-row"
          ></tr>
        </table>

        <mat-paginator
          #paginatorCompleted
          [pageSize]="pageSize"
          [pageSizeOptions]="pageSizeOptions"
          (page)="pageEventCompleted = $event"
        >
        </mat-paginator>
      </mat-tab>

      <!-- ARCHIVED -->
      <mat-tab>
        <ng-template mat-tab-label>
          <fa-icon [icon]="faArchive"></fa-icon>
          &nbsp;{{ 'DASHBOARD.ARCHIVED' | translate }}
        </ng-template>

        <div fxLayout class="search">
          <mat-form-field class="full-width">
            <input
              matInput
              placeholder="{{ 'DASHBOARD.SEARCH' | translate }}"
              type="text"
              (keyup)="doArchivedFilter($event.target.value)"
            />
          </mat-form-field>
        </div>

        <table
          #archivedTable
          mat-table
          [dataSource]="dsArchived"
          multiTemplateDataRows
          matSort
          class="mat-elevation-z8"
        >
          <!-- attachment Column -->
          <ng-container matColumnDef="attachment">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              <fa-icon *ngIf="element.document" [icon]="faPaperclip"></fa-icon>
            </td>
          </ng-container>

          <!-- name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              {{ element.taskUserFullName }}
            </td>
            <!-- <td mat-cell *matCellDef="let element" (click)="goToDetail(element.id)">{{element.client.fullName}} </td> -->
          </ng-container>

          <!-- reference1 Column -->
          <ng-container matColumnDef="reference1">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">{{ element.reference1 }}</td>
          </ng-container>

          <!-- details Column -->
          <ng-container matColumnDef="details">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              <b>{{
                element.documentType
                  ? element.documentType.name
                  : element.details.substring(0, 20)
              }}</b>
            </td>
          </ng-container>

          <!-- adminUserName Column-->
          <ng-container matColumnDef="adminUserName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              {{ element.adminUserName }}
            </td>
          </ng-container>

          <!-- details Column -->
          <ng-container matColumnDef="date">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
              {{ element.updDt | date: 'MM/dd/yyyy hh:mm:ss a' }}
            </td>
          </ng-container>

          <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
          <ng-container matColumnDef="expandedDetail">
            <td
              mat-cell
              *matCellDef="let element"
              [attr.colspan]="displayedColumns.length"
            >
              <div
                [@detailExpand]="
                  element == expandedElement ? 'expanded' : 'collapsed'
                "
              >
                <app-task-details
                  [task]="element"
                  [actionButtons]="true"
                  (onApprove)="onApprove(element)"
                  (onArchive)="onArchive(element)"
                  (onCancel)="onCancel(element)"
                  (onRecover)="onRecover(element)"
                  (onDownloadFile)="onDownload(element.document)"
                  (onDownloadTemplate)="onDownload(element.templateFile)"
                >
                </app-task-details>
              </div>
            </td>
          </ng-container>

          <!-- <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="selection.toggle(row)"></tr> -->

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns"
            class="element-row"
            [class.expanded]="expandedElement == row"
            (click)="expandedElement = row"
          ></tr>

          <tr
            mat-row
            *matRowDef="let row; columns: ['expandedDetail']"
            class="detail-row"
          ></tr>
        </table>

        <mat-paginator
          #paginatorArchived
          [pageSize]="pageSize"
          [pageSizeOptions]="pageSizeOptions"
          (page)="pageEventArchived = $event"
        >
        </mat-paginator>
      </mat-tab>
    </mat-tab-group>
  </mat-card-content>
</mat-card>

<!-- loader.component.html -->
<div class="loading-indicator" [hidden]="!loading">
  <mat-progress-spinner [mode]="'indeterminate'"> </mat-progress-spinner>
</div>
